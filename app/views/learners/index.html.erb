<div class="main-content courses">
  <div id="filter">
    <h1 class="fleft">Most popular courses</h1>
    <div class="courses-filter fright">Order by: <span class="sprite fliterby fright">
      <select name="">
        <option selected="selected">Order by</option>
      </select>
      </span></div>
    <div class="clear"></div>
  </div>

  <ul class="courses-box">
    <% @courses.each do |course| %>
      <li>
        <div class="box">
          <span class="cource-img box-grn">
            <%= link_to image_tag(course.course_cover_pic.url(:cover)), learner_path(course) %>
          </span>
          <span class="cource-disc">
            <p class="title"><%= link_to course.title.titleize, learner_path(course) %></p>
            <ol class="cource-dtl">
              <li>Price<br />
                <span><%= course.is_paid ? number_to_currency(course.price, precision: 0) : 'Free' %></span>
              </li>
              <li><%= course.ratings.count %> Reviews<br/>
                <% if course.ratings.present? && course.ratings.find_by_ip_address(request.remote_ip).present? %>
                  <div id="course_<%= course.id %>_rating" class="rateit" data-rateit-resetable="false" data-rateit-value="<%= course.avg_rating(course.id) %>" data-rateit-ispreset="true" data-rateit-readonly="true" data-rateit-max="5" data-rateit-min="0" data-rateit-step="1"></div>
                <% else %>
                  <div id="course_<%= course.id %>_rating" class="rateit" data-rateit-resetable="false" data-rateit-value="<%= course.avg_rating(course.id) %>" data-rateit-ispreset="true" data-rateit-readonly="false" data-rateit-max="5" data-rateit-min="0" data-rateit-step="1"></div>
                <% end %>
              </li>
              <li>Students<br />
                <span class="sprite students"></span><%= course.users.where(type: 'Learner').count %>
              </li>
            </ol>
          </span>
        </div>
      </li>
    <% end %>
  </ul>

  <div class="btn1">
    <input name="Discover Courses" type="submit" value="Discover Courses" class="sprite" id="Discover Courses" />
  </div>
</div>

<%= javascript_tag do %>
  $(".rateit").bind('rated', function() {
    obj = $(this);
    $(obj).rateit('readonly', 'readonly');

    $.ajax({
      url: "<%= rate_courses_path %>",
      type: "GET",
      data: {
        course_id: $(obj).attr('id').split('_')[1],
        rate: $(obj).rateit('value')
      }
    });
  });
<% end %>
