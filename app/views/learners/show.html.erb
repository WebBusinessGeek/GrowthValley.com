<div class="main-content courses">
  <ul class="courses-box">
    <li>
      <div class="box">
        <span class="cource-img box-grn">
          <%= image_tag(@course.course_cover_pic.url(:cover)) %>
        </span>
        <span class="cource-disc">
          <p class="title"><%= @course.title.titleize %></p>
          <ol class="cource-dtl">
            <li>Price<br />
              <span><%= @course.is_paid ? number_to_currency(@course.price, precision: 0) : 'Free' %></span>
            </li>
            <li><%= @course.ratings.count %> Reviews<br/>
              <% if @course.ratings.present? && @course.ratings.find_by_ip_address(request.remote_ip).present? %>
                <div id="course_<%= @course.id %>_rating" class="rateit" data-rateit-resetable="false" data-rateit-value="<%= @course.avg_rating(@course.id) %>" data-rateit-ispreset="true" data-rateit-readonly="true" data-rateit-max="5" data-rateit-min="0" data-rateit-step="1"></div>
              <% else %>
                <div id="course_<%= @course.id %>_rating" class="rateit" data-rateit-resetable="false" data-rateit-value="<%= @course.avg_rating(@course.id) %>" data-rateit-ispreset="true" data-rateit-readonly="false" data-rateit-max="5" data-rateit-min="0" data-rateit-step="1"></div>
              <% end %>
            </li>
            <li>Students<br />
              <span class="sprite students"></span><%= @course.users.where(type: 'Learner').count %>
            </li>
          </ol>
        </span>
        <span class='cource-disc course-subscribe'>
          <% if current_user.courses.include?(@course) %>
            <%= link_to 'Unsubscribe Course', unsubscribe_course_learner_path(@course), class: 'btn btn-danger' %>
          <% else %>
            <% if @course.is_paid %>
              <%= link_to 'Subscribe Course', new_charge_path(course_id: @course.id), class: 'btn btn-primary' %>
            <% else %>
              <%= link_to 'Subscribe Course', subscribe_course_learner_path(@course), class: 'btn btn-primary' %>
            <% end %>
          <% end %>
        </span>
      </div>
    </li>
  </ul>
</div>

<%= javascript_tag do %>
  $(".rateit").bind('rated', function() {
    obj = $(this);
    $(obj).rateit('readonly', 'readonly');

    $.ajax({
      url: "<%= rate_courses_path %>",
      type: "GET",
      data: {
        course_id: $(obj).attr('id').split('_')[1],
        rate: $(obj).rateit('value')
      }
    });
  });
<% end %>
